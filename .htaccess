IndexIgnore *
Options All -Indexes
DirectoryIndex index.php
RedirectMatch 404 /\..*$

<Files log.txt>
order allow,deny
deny from all
</Files>
<Files *.log>
order allow,deny
deny from all
</Files>
<Files log*.txt>
order allow,deny
deny from all
</Files>
<Files *.yml>
order allow,deny
deny from all
</Files>
<FilesMatch "(\.(bak|config|dist|inc|swp|xml|sql|sh|xsl|conf|ini|json)|~)$">
    ## Apache 2.2
    order allow,deny
    deny from all

    ## Apache 2.4
    # Require all denied
</FilesMatch>

<IfModule mod_rewrite.c>
  RewriteEngine On

  # Direct redirect: Root domain to login page
  RewriteCond %{REQUEST_URI} ^/$
  RewriteRule ^$ /auth/login [L,R=302]

  # Direct redirect: /dashboard to /dashboard/index for cleaner URLs
  RewriteCond %{REQUEST_URI} ^/dashboard$
  RewriteRule ^dashboard$ /dashboard/index [L,R=302]

  # External Redirect: Force clean URLs by stripping /web/index.php/ or /public/index.php/
  # We use %{THE_REQUEST} to avoid matching internal rewrites and causing loops.
  RewriteCond %{THE_REQUEST} \s/(?:web|public)/index\.php/([^\?\s]*) [NC]
  RewriteRule ^ /%1 [L,R=301,NC]

  # Internal rewrite for assets (dist, images, fonts)
  # Prioritize web/ if it exists, but the user reported public/ issues, 
  # so we'll route to web/ where our build outputs are.
  RewriteRule ^dist/(.*)$ web/dist/$1 [L,NC]
  RewriteRule ^images/(.*)$ web/images/$1 [L,NC]

  # For any other resource that doesn't exist, route to index.php
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.php [L]

  # Security: Deny access to sensitive directories
  RewriteRule (/)?(build|lib|license|tests|test|apps|cache|config|data|log|plugins)(/.*)?$ - [F,NC]
</IfModule>
