{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { APIService } from '@ohrm/core/util/services/api.service';\nimport { reloadPage } from '@ohrm/core/util/helper/navigation';\nimport { required } from '@/core/util/validation/rules';\nimport { addDays, formatDate, parseDate } from '@/core/util/helper/datefns';\nimport useDateFormat from '@/core/util/composable/useDateFormat';\nimport useLocale from '@/core/util/composable/useLocale';\nconst leavePeriodModel = {\n  startMonth: null,\n  startDay: null,\n  currentPeriod: null\n};\nexport default {\n  props: {\n    monthDates: {\n      type: Object,\n      required: true\n    }\n  },\n  setup() {\n    const http = new APIService(window.appGlobal.baseUrl, '/api/v2/leave/leave-period');\n    const {\n      jsDateFormat\n    } = useDateFormat();\n    const {\n      locale\n    } = useLocale();\n    return {\n      http,\n      jsDateFormat,\n      locale\n    };\n  },\n  data() {\n    return {\n      isLoading: false,\n      leavePeriod: {\n        ...leavePeriodModel\n      },\n      leavePeriodDefined: true,\n      rules: {\n        startMonth: [required],\n        startDay: [required]\n      }\n    };\n  },\n  computed: {\n    months() {\n      return Array(12).fill('').map((...[, index]) => {\n        return {\n          id: index + 1,\n          label: this.locale.localize.month(index, {\n            width: 'wide'\n          })\n        };\n      });\n    },\n    dates() {\n      return (this.monthDates[this.leavePeriod.startMonth?.id] ?? []).map(day => {\n        return {\n          id: day,\n          label: String(day).padStart(2, '0')\n        };\n      });\n    },\n    endDay() {\n      const month = this.leavePeriod.startMonth?.id;\n      const date = this.leavePeriod.startDay?.id;\n      const year = new Date().getFullYear();\n      if (month && date) {\n        const endDay = addDays(new Date(year, month - 1, date), 364);\n        const isFollowingYear = endDay.getFullYear() > year;\n        return formatDate(endDay, 'LLLL dd', {\n          locale: this.locale\n        }) + (isFollowingYear ? ` (${this.$t('leave.following_year')})` : '');\n      }\n      return '-';\n    }\n  },\n  watch: {\n    'leavePeriod.startMonth': function () {\n      this.leavePeriod.startDay = this.dates.length > 0 ? this.dates[0] : null;\n    }\n  },\n  beforeMount() {\n    this.isLoading = true;\n    this.http.request({\n      method: 'GET'\n    }).then(response => {\n      const {\n        data,\n        meta\n      } = response.data;\n      this.updateLeavePeriodModel(data);\n      this.defineLeavePeriod(meta);\n      this.resetLeavePeriod();\n    }).finally(() => {\n      this.isLoading = false;\n    });\n  },\n  methods: {\n    onSave() {\n      this.isLoading = true;\n      this.http.request({\n        method: 'PUT',\n        data: {\n          startMonth: this.leavePeriod.startMonth?.id,\n          startDay: this.leavePeriod.startDay?.id\n        }\n      }).then(response => {\n        const {\n          data,\n          meta\n        } = response.data;\n        this.updateLeavePeriodModel(data);\n        this.defineLeavePeriod(meta);\n        this.resetLeavePeriod();\n        return this.$toast.saveSuccess();\n      }).then(() => {\n        this.isLoading = false;\n        if (!this.leavePeriodDefined) {\n          reloadPage();\n        }\n      });\n    },\n    onClickReset() {\n      this.resetLeavePeriod();\n    },\n    resetLeavePeriod() {\n      this.leavePeriod.startMonth = leavePeriodModel.startMonth;\n      this.$nextTick(() => {\n        this.leavePeriod.startDay = leavePeriodModel.startDay;\n      });\n    },\n    updateLeavePeriodModel(data) {\n      leavePeriodModel.startMonth = this.months.find(m => {\n        return m.id === data.startMonth;\n      });\n      this.$nextTick(() => {\n        leavePeriodModel.startDay = this.dates.find(d => {\n          return d.id === data.startDay;\n        });\n      });\n    },\n    defineLeavePeriod(meta) {\n      if (meta.leavePeriodDefined === true) {\n        this.leavePeriodDefined = meta.leavePeriodDefined;\n        const startDate = formatDate(parseDate(meta.currentLeavePeriod.startDate), this.jsDateFormat, {\n          locale: this.locale\n        });\n        const endDate = formatDate(parseDate(meta.currentLeavePeriod.endDate), this.jsDateFormat, {\n          locale: this.locale\n        });\n        this.leavePeriod.currentPeriod = `${startDate} ${this.$t('general.to').toLowerCase()} ${endDate}`;\n      } else {\n        this.leavePeriodDefined = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["APIService","reloadPage","required","addDays","formatDate","parseDate","useDateFormat","useLocale","leavePeriodModel","startMonth","startDay","currentPeriod","props","monthDates","type","Object","setup","http","window","appGlobal","baseUrl","jsDateFormat","locale","data","isLoading","leavePeriod","leavePeriodDefined","rules","computed","months","Array","fill","map","index","id","label","localize","month","width","dates","day","String","padStart","endDay","date","year","Date","getFullYear","isFollowingYear","$t","watch","leavePeriod.startMonth","length","beforeMount","request","method","then","response","meta","updateLeavePeriodModel","defineLeavePeriod","resetLeavePeriod","finally","methods","onSave","$toast","saveSuccess","onClickReset","$nextTick","find","m","d","startDate","currentLeavePeriod","endDate","toLowerCase"],"sources":["C:\\Users\\x\\Documents\\Projects\\HRM\\XHRM\\src\\client\\src\\XHRMLeavePlugin\\pages\\configure\\LeavePeriod.vue"],"sourcesContent":["<!--\n/**\n * XHRM is a comprehensive Human Resource Management (HRM) System that captures\n * all the essential functionalities required for any enterprise.\n * Copyright (C) 2006 XHRM Inc., http://www.XHRM.com\n *\n * XHRM is free software: you can redistribute it and/or modify it under the terms of\n * the GNU General Public License as published by the Free Software Foundation, either\n * version 3 of the License, or (at your option) any later version.\n *\n * XHRM is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License along with XHRM.\n * If not, see <https://www.gnu.org/licenses/>.\n */\n -->\n\n<template>\n  <div class=\"XHRM-background-container\">\n    <div class=\"XHRM-card-container\">\n      <oxd-text class=\"XHRM-main-title\">\n        {{ $t('leave.leave_period') }}\n      </oxd-text>\n\n      <oxd-divider />\n\n      <oxd-form :loading=\"isLoading\" @submit-valid=\"onSave\">\n        <oxd-form-row>\n          <oxd-grid :cols=\"4\" class=\"XHRM-full-width-grid\">\n            <oxd-grid-item>\n              <oxd-input-field\n                v-model=\"leavePeriod.startMonth\"\n                type=\"select\"\n                :options=\"months\"\n                :rules=\"rules.startMonth\"\n                :label=\"$t('leave.start_month')\"\n                required\n              />\n            </oxd-grid-item>\n\n            <oxd-grid-item>\n              <oxd-input-field\n                v-model=\"leavePeriod.startDay\"\n                type=\"select\"\n                :options=\"dates\"\n                :rules=\"rules.startDay\"\n                :label=\"$t('general.start_date')\"\n                required\n              />\n            </oxd-grid-item>\n          </oxd-grid>\n        </oxd-form-row>\n\n        <oxd-form-row>\n          <oxd-grid :cols=\"4\" class=\"XHRM-full-width-grid\">\n            <oxd-grid-item>\n              <oxd-input-group :label=\"$t('general.end_date')\">\n                <oxd-text type=\"subtitle-2\" class=\"XHRM-leave-period\">\n                  {{ endDay }}\n                </oxd-text>\n              </oxd-input-group>\n            </oxd-grid-item>\n\n            <oxd-grid-item v-if=\"leavePeriod.currentPeriod\">\n              <oxd-input-group :label=\"$t('leave.current_leave_period')\">\n                <oxd-text type=\"subtitle-2\" class=\"XHRM-leave-period\">\n                  {{ leavePeriod.currentPeriod }}\n                </oxd-text>\n              </oxd-input-group>\n            </oxd-grid-item>\n          </oxd-grid>\n        </oxd-form-row>\n\n        <oxd-divider />\n\n        <oxd-form-actions>\n          <required-text />\n          <oxd-button\n            display-type=\"ghost\"\n            :label=\"$t('general.reset')\"\n            @click=\"onClickReset\"\n          />\n          <submit-button />\n        </oxd-form-actions>\n      </oxd-form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {APIService} from '@ohrm/core/util/services/api.service';\nimport {reloadPage} from '@ohrm/core/util/helper/navigation';\nimport {required} from '@/core/util/validation/rules';\nimport {addDays, formatDate, parseDate} from '@/core/util/helper/datefns';\nimport useDateFormat from '@/core/util/composable/useDateFormat';\nimport useLocale from '@/core/util/composable/useLocale';\n\nconst leavePeriodModel = {\n  startMonth: null,\n  startDay: null,\n  currentPeriod: null,\n};\n\nexport default {\n  props: {\n    monthDates: {\n      type: Object,\n      required: true,\n    },\n  },\n\n  setup() {\n    const http = new APIService(\n      window.appGlobal.baseUrl,\n      '/api/v2/leave/leave-period',\n    );\n    const {jsDateFormat} = useDateFormat();\n    const {locale} = useLocale();\n    return {\n      http,\n      jsDateFormat,\n      locale,\n    };\n  },\n\n  data() {\n    return {\n      isLoading: false,\n      leavePeriod: {...leavePeriodModel},\n      leavePeriodDefined: true,\n      rules: {\n        startMonth: [required],\n        startDay: [required],\n      },\n    };\n  },\n\n  computed: {\n    months() {\n      return Array(12)\n        .fill('')\n        .map((...[, index]) => {\n          return {\n            id: index + 1,\n            label: this.locale.localize.month(index, {\n              width: 'wide',\n            }),\n          };\n        });\n    },\n    dates() {\n      return (this.monthDates[this.leavePeriod.startMonth?.id] ?? []).map(\n        (day) => {\n          return {\n            id: day,\n            label: String(day).padStart(2, '0'),\n          };\n        },\n      );\n    },\n    endDay() {\n      const month = this.leavePeriod.startMonth?.id;\n      const date = this.leavePeriod.startDay?.id;\n      const year = new Date().getFullYear();\n      if (month && date) {\n        const endDay = addDays(new Date(year, month - 1, date), 364);\n        const isFollowingYear = endDay.getFullYear() > year;\n        return (\n          formatDate(endDay, 'LLLL dd', {locale: this.locale}) +\n          (isFollowingYear ? ` (${this.$t('leave.following_year')})` : '')\n        );\n      }\n      return '-';\n    },\n  },\n\n  watch: {\n    'leavePeriod.startMonth': function () {\n      this.leavePeriod.startDay = this.dates.length > 0 ? this.dates[0] : null;\n    },\n  },\n\n  beforeMount() {\n    this.isLoading = true;\n    this.http\n      .request({\n        method: 'GET',\n      })\n      .then((response) => {\n        const {data, meta} = response.data;\n        this.updateLeavePeriodModel(data);\n        this.defineLeavePeriod(meta);\n        this.resetLeavePeriod();\n      })\n      .finally(() => {\n        this.isLoading = false;\n      });\n  },\n\n  methods: {\n    onSave() {\n      this.isLoading = true;\n      this.http\n        .request({\n          method: 'PUT',\n          data: {\n            startMonth: this.leavePeriod.startMonth?.id,\n            startDay: this.leavePeriod.startDay?.id,\n          },\n        })\n        .then((response) => {\n          const {data, meta} = response.data;\n          this.updateLeavePeriodModel(data);\n          this.defineLeavePeriod(meta);\n          this.resetLeavePeriod();\n          return this.$toast.saveSuccess();\n        })\n        .then(() => {\n          this.isLoading = false;\n          if (!this.leavePeriodDefined) {\n            reloadPage();\n          }\n        });\n    },\n\n    onClickReset() {\n      this.resetLeavePeriod();\n    },\n\n    resetLeavePeriod() {\n      this.leavePeriod.startMonth = leavePeriodModel.startMonth;\n      this.$nextTick(() => {\n        this.leavePeriod.startDay = leavePeriodModel.startDay;\n      });\n    },\n\n    updateLeavePeriodModel(data) {\n      leavePeriodModel.startMonth = this.months.find((m) => {\n        return m.id === data.startMonth;\n      });\n      this.$nextTick(() => {\n        leavePeriodModel.startDay = this.dates.find((d) => {\n          return d.id === data.startDay;\n        });\n      });\n    },\n\n    defineLeavePeriod(meta) {\n      if (meta.leavePeriodDefined === true) {\n        this.leavePeriodDefined = meta.leavePeriodDefined;\n        const startDate = formatDate(\n          parseDate(meta.currentLeavePeriod.startDate),\n          this.jsDateFormat,\n          {locale: this.locale},\n        );\n        const endDate = formatDate(\n          parseDate(meta.currentLeavePeriod.endDate),\n          this.jsDateFormat,\n          {locale: this.locale},\n        );\n        this.leavePeriod.currentPeriod = `${startDate} ${this.$t(\n          'general.to',\n        ).toLowerCase()} ${endDate}`;\n      } else {\n        this.leavePeriodDefined = false;\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.XHRM-leave-duration {\n  padding: $oxd-input-control-vertical-padding 0rem;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}