{"ast":null,"code":"import { toRefs, reactive, computed, watchPostEffect } from 'vue';\nimport { APIService } from '@ohrm/core/util/services/api.service';\nimport LeaveBalanceModal from '@/XHRMLeavePlugin/components/LeaveBalanceModal';\nimport LeaveBalanceInsufficientModal from '@/XHRMLeavePlugin/components/LeaveBalanceInsufficientModal';\nimport useLeaveValidators from '@/XHRMLeavePlugin/util/composable/useLeaveValidators';\nimport { OxdLabel } from '@ohrm/oxd';\nexport default {\n  name: 'LeaveBalance',\n  components: {\n    'oxd-label': OxdLabel,\n    'leave-balance-modal': LeaveBalanceModal,\n    'leave-balance-insufficient-modal': LeaveBalanceInsufficientModal\n  },\n  inheritAttrs: false,\n  props: {\n    leaveData: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  setup(props) {\n    const state = reactive({\n      data: null,\n      meta: null,\n      balance: 0,\n      showModal: false\n    });\n    const http = new APIService(window.appGlobal.baseUrl, '/api/v2/leave/leave-balance/leave-type');\n    http.setIgnorePath('/api/v2/leave/leave-balance/leave-type');\n    const {\n      validateLeaveBalance\n    } = useLeaveValidators(http);\n    const leaveBalance = computed(() => {\n      return props.leaveData.type?.id ? `${state.balance.toFixed(2)} Day(s)` : '0.00 Day(s)';\n    });\n    const onModalOpen = () => {\n      state.showModal = true;\n    };\n    const onModalClose = () => {\n      state.showModal = false;\n    };\n    const leaveBalanceModal = computed(() => {\n      return Array.isArray(state.data) ? 'leave-balance-insufficient-modal' : 'leave-balance-modal';\n    });\n    watchPostEffect(async () => {\n      if (props.leaveData.type?.id) {\n        validateLeaveBalance(props.leaveData).then(({\n          balance,\n          breakdown,\n          metaData\n        }) => {\n          state.balance = balance;\n          if (breakdown) state.data = breakdown;\n          if (metaData) state.meta = metaData;\n        }).catch(() => {\n          state.data = null;\n          state.meta = null;\n          state.balance = 0;\n        });\n      }\n    });\n    return {\n      ...toRefs(state),\n      leaveBalance,\n      onModalOpen,\n      onModalClose,\n      leaveBalanceModal\n    };\n  }\n};","map":{"version":3,"names":["toRefs","reactive","computed","watchPostEffect","APIService","LeaveBalanceModal","LeaveBalanceInsufficientModal","useLeaveValidators","OxdLabel","name","components","inheritAttrs","props","leaveData","type","Object","default","setup","state","data","meta","balance","showModal","http","window","appGlobal","baseUrl","setIgnorePath","validateLeaveBalance","leaveBalance","id","toFixed","onModalOpen","onModalClose","leaveBalanceModal","Array","isArray","then","breakdown","metaData","catch"],"sources":["C:\\Users\\x\\Documents\\Projects\\HRM\\XHRM\\src\\client\\src\\XHRMLeavePlugin\\components\\LeaveBalance.vue"],"sourcesContent":["<!--\n/**\n * XHRM is a comprehensive Human Resource Management (HRM) System that captures\n * all the essential functionalities required for any enterprise.\n * Copyright (C) 2006 XHRM Inc., http://www.XHRM.com\n *\n * XHRM is free software: you can redistribute it and/or modify it under the terms of\n * the GNU General Public License as published by the Free Software Foundation, either\n * version 3 of the License, or (at your option) any later version.\n *\n * XHRM is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License along with XHRM.\n * If not, see <https://www.gnu.org/licenses/>.\n */\n -->\n\n<template>\n  <oxd-input-group>\n    <template #label>\n      <div class=\"XHRM-leave-balance\">\n        <oxd-label :label=\"$t('leave.leave_balance')\" />\n        <oxd-icon-button\n          v-if=\"leaveData.type\"\n          class=\"--help\"\n          name=\"question-circle\"\n          :with-container=\"false\"\n          @click=\"onModalOpen\"\n        />\n      </div>\n    </template>\n    <oxd-text v-if=\"balance >= 0\" class=\"XHRM-leave-balance-text\" tag=\"p\">\n      {{ leaveBalance }}\n    </oxd-text>\n    <oxd-text v-else class=\"XHRM-leave-balance-text --error\" tag=\"p\">\n      {{ $t('leave.balance_not_sufficient') }}\n    </oxd-text>\n  </oxd-input-group>\n  <component\n    :is=\"leaveBalanceModal\"\n    v-if=\"showModal\"\n    :data=\"data\"\n    :meta=\"meta\"\n    @close=\"onModalClose\"\n  ></component>\n</template>\n\n<script>\nimport {toRefs, reactive, computed, watchPostEffect} from 'vue';\nimport {APIService} from '@ohrm/core/util/services/api.service';\nimport LeaveBalanceModal from '@/XHRMLeavePlugin/components/LeaveBalanceModal';\nimport LeaveBalanceInsufficientModal from '@/XHRMLeavePlugin/components/LeaveBalanceInsufficientModal';\nimport useLeaveValidators from '@/XHRMLeavePlugin/util/composable/useLeaveValidators';\nimport {OxdLabel} from '@ohrm/oxd';\n\nexport default {\n  name: 'LeaveBalance',\n  components: {\n    'oxd-label': OxdLabel,\n    'leave-balance-modal': LeaveBalanceModal,\n    'leave-balance-insufficient-modal': LeaveBalanceInsufficientModal,\n  },\n  inheritAttrs: false,\n  props: {\n    leaveData: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n  setup(props) {\n    const state = reactive({\n      data: null,\n      meta: null,\n      balance: 0,\n      showModal: false,\n    });\n    const http = new APIService(\n      window.appGlobal.baseUrl,\n      '/api/v2/leave/leave-balance/leave-type',\n    );\n    http.setIgnorePath('/api/v2/leave/leave-balance/leave-type');\n    const {validateLeaveBalance} = useLeaveValidators(http);\n\n    const leaveBalance = computed(() => {\n      return props.leaveData.type?.id\n        ? `${state.balance.toFixed(2)} Day(s)`\n        : '0.00 Day(s)';\n    });\n\n    const onModalOpen = () => {\n      state.showModal = true;\n    };\n\n    const onModalClose = () => {\n      state.showModal = false;\n    };\n\n    const leaveBalanceModal = computed(() => {\n      return Array.isArray(state.data)\n        ? 'leave-balance-insufficient-modal'\n        : 'leave-balance-modal';\n    });\n\n    watchPostEffect(async () => {\n      if (props.leaveData.type?.id) {\n        validateLeaveBalance(props.leaveData)\n          .then(({balance, breakdown, metaData}) => {\n            state.balance = balance;\n            if (breakdown) state.data = breakdown;\n            if (metaData) state.meta = metaData;\n          })\n          .catch(() => {\n            state.data = null;\n            state.meta = null;\n            state.balance = 0;\n          });\n      }\n    });\n\n    return {\n      ...toRefs(state),\n      leaveBalance,\n      onModalOpen,\n      onModalClose,\n      leaveBalanceModal,\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.XHRM-leave-balance {\n  display: flex;\n  align-items: center;\n  & .--help {\n    margin-left: 5px;\n  }\n}\n.XHRM-leave-balance-text {\n  padding: $oxd-input-control-vertical-padding 0rem;\n  &.--error {\n    color: $oxd-feedback-danger-color;\n  }\n}\n</style>\n"],"mappings":"AAkDA,SAAQA,MAAM,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,eAAe,QAAO,KAAK;AAC/D,SAAQC,UAAU,QAAO,sCAAsC;AAC/D,OAAOC,iBAAgB,MAAO,gDAAgD;AAC9E,OAAOC,6BAA4B,MAAO,4DAA4D;AACtG,OAAOC,kBAAiB,MAAO,sDAAsD;AACrF,SAAQC,QAAQ,QAAO,WAAW;AAElC,eAAe;EACbC,IAAI,EAAE,cAAc;EACpBC,UAAU,EAAE;IACV,WAAW,EAAEF,QAAQ;IACrB,qBAAqB,EAAEH,iBAAiB;IACxC,kCAAkC,EAAEC;EACtC,CAAC;EACDK,YAAY,EAAE,KAAK;EACnBC,KAAK,EAAE;IACLC,SAAS,EAAE;MACTC,IAAI,EAAEC,MAAM;MACZC,OAAO,EAAEA,CAAA,MAAO,CAAC,CAAC;IACpB;EACF,CAAC;EACDC,KAAKA,CAACL,KAAK,EAAE;IACX,MAAMM,KAAI,GAAIjB,QAAQ,CAAC;MACrBkB,IAAI,EAAE,IAAI;MACVC,IAAI,EAAE,IAAI;MACVC,OAAO,EAAE,CAAC;MACVC,SAAS,EAAE;IACb,CAAC,CAAC;IACF,MAAMC,IAAG,GAAI,IAAInB,UAAU,CACzBoB,MAAM,CAACC,SAAS,CAACC,OAAO,EACxB,wCACF,CAAC;IACDH,IAAI,CAACI,aAAa,CAAC,wCAAwC,CAAC;IAC5D,MAAM;MAACC;IAAoB,IAAIrB,kBAAkB,CAACgB,IAAI,CAAC;IAEvD,MAAMM,YAAW,GAAI3B,QAAQ,CAAC,MAAM;MAClC,OAAOU,KAAK,CAACC,SAAS,CAACC,IAAI,EAAEgB,EAAC,GAC1B,GAAGZ,KAAK,CAACG,OAAO,CAACU,OAAO,CAAC,CAAC,CAAC,SAAQ,GACnC,aAAa;IACnB,CAAC,CAAC;IAEF,MAAMC,WAAU,GAAIA,CAAA,KAAM;MACxBd,KAAK,CAACI,SAAQ,GAAI,IAAI;IACxB,CAAC;IAED,MAAMW,YAAW,GAAIA,CAAA,KAAM;MACzBf,KAAK,CAACI,SAAQ,GAAI,KAAK;IACzB,CAAC;IAED,MAAMY,iBAAgB,GAAIhC,QAAQ,CAAC,MAAM;MACvC,OAAOiC,KAAK,CAACC,OAAO,CAAClB,KAAK,CAACC,IAAI,IAC3B,kCAAiC,GACjC,qBAAqB;IAC3B,CAAC,CAAC;IAEFhB,eAAe,CAAC,YAAY;MAC1B,IAAIS,KAAK,CAACC,SAAS,CAACC,IAAI,EAAEgB,EAAE,EAAE;QAC5BF,oBAAoB,CAAChB,KAAK,CAACC,SAAS,EACjCwB,IAAI,CAAC,CAAC;UAAChB,OAAO;UAAEiB,SAAS;UAAEC;QAAQ,CAAC,KAAK;UACxCrB,KAAK,CAACG,OAAM,GAAIA,OAAO;UACvB,IAAIiB,SAAS,EAAEpB,KAAK,CAACC,IAAG,GAAImB,SAAS;UACrC,IAAIC,QAAQ,EAAErB,KAAK,CAACE,IAAG,GAAImB,QAAQ;QACrC,CAAC,EACAC,KAAK,CAAC,MAAM;UACXtB,KAAK,CAACC,IAAG,GAAI,IAAI;UACjBD,KAAK,CAACE,IAAG,GAAI,IAAI;UACjBF,KAAK,CAACG,OAAM,GAAI,CAAC;QACnB,CAAC,CAAC;MACN;IACF,CAAC,CAAC;IAEF,OAAO;MACL,GAAGrB,MAAM,CAACkB,KAAK,CAAC;MAChBW,YAAY;MACZG,WAAW;MACXC,YAAY;MACZC;IACF,CAAC;EACH;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}